<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>Factures</h4>
  
</div>

<!-- Table des factures -->
<div class="table-responsive">
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Numéro Proforma</th>
        <th>Client</th>
        <th>Total TTC</th>
          <th>Etablir Par</th>
        <th>Status</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let f of factures">
        <td>{{ f.date | date:'dd-MM-yyyy' }}</td>
        <td>{{ f.type_facture }}</td>
        <td>{{ f.num_proforma }}</td>
        <td>{{ f.client_name }}</td>
        <td class="text-end">{{ f.total_ttc| number:'1.2-2' }} </td>
         <td>{{ f.user_name }}</td>

        <td>
          <span class="badge" [ngClass]="getStatusBadgeClass(f.status)">
            {{ f.status }}
          </span>
        </td>
        <td>
          <div class="btn-group">
            <div>
                <button 
                    class="btn btn-primary btn-sm me-2"
                    (click)="getPdfUrl(f.id)"
                    title="Voir la facture">
                    <i class="fas fa-file-pdf"></i>
                </button>
                <button class="btn btn-danger btn-sm me-1" (click)="openRefusModal(refusModal, f)" title="Refuser la Facture">
                    <i class="fas fa-times-circle"></i>
                  </button>
                <button 
                class="btn btn-success btn-sm me-2"
                (click)="validateFacture(f.id)"
                title="Approuvé la facture">
                <i class="fas fa-check-circle"></i>
                </button>
                
            </div>
           
          </div>
        </td>
      </tr>
    </tbody>
  </table>

   <!-- MODALE DE REFUS -->
  <ng-template #refusModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Motif de refus de la Facture</h5>
      <button type="button" class="btn-close" aria-label="Fermer" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <textarea [(ngModel)]="motifRefus" rows="4" class="form-control" placeholder="Saisissez le motif du refus..."></textarea>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="modal.dismiss()">Annuler</button>
      <button class="btn btn-danger" (click)="refuserFacture(modal)">Confirmer le refus</button>
    </div>
  </ng-template>
</div>
